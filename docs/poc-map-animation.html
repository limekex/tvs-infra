<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virtual Training Experience - Proof of Concept</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #1a1a1a;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    #container {
      position: fixed;
      width: 7900px;
      height: 5600px;
      left: 50%;
      top: 50%;
      opacity: 0;
    }

    #mapContainer {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* Info overlay */
    #info {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px 25px;
      border-radius: 12px;
      font-size: 14px;
      z-index: 1000;
      backdrop-filter: blur(10px);
      min-width: 220px;
    }

    #info h2 {
      margin: 0 0 15px 0;
      font-size: 20px;
      border-bottom: 2px solid #4ade80;
      padding-bottom: 10px;
    }

    #info .stat-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 14px;
    }

    #info .stat-label {
      color: #999;
    }

    #info .stat-value {
      font-weight: bold;
      color: #4ade80;
      font-size: 16px;
    }

    #info .speed-controls {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #333;
    }

    #info input[type="number"] {
      width: 80px;
      padding: 8px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #444;
      border-radius: 6px;
      color: white;
      font-size: 16px;
      text-align: center;
    }

    #info input[type="number"]:focus {
      outline: none;
      border-color: #4ade80;
    }

    /* Control buttons */
    #controls {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      z-index: 1000;
    }

    .btn {
      background: rgba(0, 0, 0, 0.8);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      backdrop-filter: blur(10px);
      transition: all 0.3s;
      font-weight: 600;
    }

    .btn:hover {
      background: rgba(0, 0, 0, 0.95);
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    }

    /* Progress bar */
    #progressBar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      z-index: 999;
    }

    #progressFill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
      transition: width 0.1s ease-out;
    }

    /* Route path styling */
    .route-path {
      stroke: #3b82f6;
      stroke-width: 5;
      fill: none;
      filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.5));
    }

    .route-marker {
      fill: #ef4444;
      filter: drop-shadow(0 2px 8px rgba(239, 68, 68, 0.8));
    }

    /* Welcome screen */
    #welcome {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 40px 50px;
      border-radius: 16px;
      text-align: center;
      z-index: 2000;
      backdrop-filter: blur(20px);
    }

    #welcome h3 {
      margin: 0 0 15px 0;
      font-size: 28px;
    }

    #welcome p {
      margin: 10px 0;
      font-size: 16px;
      opacity: 0.8;
    }

    #welcome .speed-input-group {
      margin: 25px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    #welcome .speed-input-group input {
      width: 100px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #4ade80;
      border-radius: 8px;
      color: white;
      font-size: 24px;
      text-align: center;
      font-weight: bold;
    }

    #welcome .speed-input-group label {
      font-size: 18px;
      color: #4ade80;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>

  <!-- Welcome screen -->
  <div id="welcome">
    <h3>üèÉ‚Äç‚ôÇÔ∏è Virtual Training Experience</h3>
    <p>Enter your speed to start the virtual route</p>
    <div class="speed-input-group">
      <input type="number" id="speedInput" value="12" min="1" max="50" step="0.5">
      <label>km/h</label>
    </div>
    <button class="btn btn-primary" onclick="startTraining()">Start Training</button>
    <p style="margin-top: 20px; font-size: 14px;">
      Route: Sunday Bike Route (8.2 km)
    </p>
  </div>

  <!-- Main container that moves -->
  <div id="container">
    <!-- Map placeholder (will be replaced with actual Mapbox later) -->
    <div id="mapContainer">
      <img src="https://assets.codepen.io/721952/mtp.png" />
    </div>

    <!-- SVG overlay with route path -->
    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
      <!-- Marker (red circle) -->
      <circle id="marker" class="route-marker" r="12" />
      
      <!-- Route path (full route visible from start) -->
      <path id="routePath" class="route-path" d="M3847.5,2753.5l-6,4c0,0-8,4-6,7s21,35,23,39s-0.56,5.75-0.56,5.75L3690.5,2923.5c0,0-13,10-15,20s-4,62-7,73s-7,27-30,43s-49,27-55,30s1,13,0,20s-35,27-42,35s-5,19,0,35s17,31-5,47s-27,4-33,10s-122,102-129,110s-17,16-16,31v60c0,0,25,13,33,15s59,6,68,13s21,18,23,24s2,11-16,25s-601,583-601,583s-104-109-113-114s-14-10-28-26s-63-67-68-76s-76-83-85-95s-34-38-60-51s-115-36-129-39s-35-8-46-6s-55,6-65,5s-35,0-43-3s-31-18-41-30s-32-34-43-42s-42-25-58-29s-306-50-336-54s-275-44-314-48s-62-4-78-1s-33,11-40,24s-17,31-11,50s24,41,31,57s6,5,6,5l-7-15c0,0-17-25-20-32s-17-28-3-52s17-22,26-26s13-7,34-8s51,2,73,4s324,49,381,58s228,35,244,39c0,0,48,12,67,30s32,29,40,38s37,31,44,33c2,5-1,4-9,5s-20,3-30,8s-37,5-49,7s-42,0-49,4s-25,15-29,25c0,0-17,35-19,46s-3,25,3,31s15,12,22,13s19,5,24,11s7,8,8,14s0,43-1,50s-4,12-7,15s-9,2-10,5s-4,7,0,9s10,1,15,6s9,14,12,17s10,10,16,9s16-4,22-7s15-5,21,1s11,7,9,4s-7-9-13-10s-13-2-16,0s-17,17-23,16s-13-4-16-7s-5-13-8-11s-14,5-19,5s-15-3-16,1s-5,20-6,23s-6,6-13,10s-36,19-36,19c-7,4-7,1-2-2s40-20,42-22s6-3,7-11s3-17,4-19s3-8,8-13s6-8,10-7s10-1,11-4s1-5,5-9s6-8,8-21s1-43,0-50s-7-18-16-21s-16-4-22-6s-18-9-19-18s0-14,5-27s17-45,25-50s15-10,28-11s60-4,68-5s15-4,18-6s15-6,23-6s13-1,15-3s4-4,6-5s5,0,10,1s21,4,26,3s15-2,16-1s1,4,1,8s4,11,11,18s11,12,13,16s5,12,6,19s-1,16,7,26s24,19,34,20s36,3,53-2s27-7,27-9s0-13-1-15s-10-20-10-26s7-38,8-41s2-1,8,1s32,10,40,12s34,13,44,20s29,23,38,34s41,45,46,51s20,24,22,26s-1,4-3,5s-11,8-13,9s0,2,5,7s17,21,19,23s0,3-3,5s-14,11-16,11s-4-5-7-3s-6,6-10,1s-8-11-11-11s-37,13-41,14s-4,3-3,5s3,8,7,9s29-8,32-8s3,1,3,4s2,25,3,26s4-1,7-4s28-23,29-21s74,82,76,85s4,4,7,2s9-7,11-9s3-2,7,2s102,104,105,107s6,7,2,10s-14,12-16,14s-2,5,1,8s84,83,86,86s4,2,8-2s11-11,14-14s4-2,7,1s37,39,43,45s21,21,26,32s9,22,13,43s3,21,5,23s0-3,0-5s-4-30-7-39s-7-22-10-26s-52-60-62-69s-10-10-8-12s322-309,325-312s3-3,6,3s367,733,369,738s7,11,0,14s-181,90-185,93s-12,4-23,4s-149,1-153,0s-16-2-25-5s-30-8-39-9s-34-5-48-6s-15-1-20-1s-14-1-22-2s-16-3-25-20s-26-29-33-35s-29-22-38-36s-28-51-32-69s-4-16-8-17s-4,1-1,2s4,1,4,5s3,12,5,19s17,44,25,55s12,17,19,23s23,21,32,27s13,12,18,19s7,11,11,17s12,12,20,13s23,2,26,2s5-3,7-8s4-7,3-10s-2-4-6-3s-6,2-5,4s2,4,4,3s3-2,3,0s-1,4-2,7s-5,7,0,8s16-2,17,0s1,6,0,13s0,6,4,7s44,11,50,11s16-1,20-4s9-6,11-6s3,2,2,7s-1,9,2,10s17,2,20,4s6,3,13,3s49,1,50,1s3,3,2,8s0,6,5,6s38-1,45-2s42-14,44-15s7-5,9-4s3,3,7,1s58-30,62-33s284-145,288-147s6-3,7-1s2,5,4,9s2,7,9,3s167-86,171-88s6-1,8,3s10,20,11,23s3,5,11,1s31-15,39-24s56-53,58-55s23-61,24-64s-1-7-6-11s-24-25-25-27s-4-4,3-10s28-24,28-29s-1-9,6-12s63-30,76-38s33-20,36-22s5,0,7,2s8,9,17,9s45,0,75-18s51-33,54-35s10,0,13,3s8,5,13,1s355-210,357-213s7-6,4-15s-14-25-15-28s0-6,4-7s5-5,3-7s-3-7,1-9s42-24,45-26s2-8,0-12s-14-36-17-40s-16-24-16-27s3-7,9-10s9-7,11-6s6,1,7-1s9-13,14-14s15-4,18-5s13-7,15-7s4-1,8-5s39-36,41-37s40-13,46-16s38-16,41-18s58-37,62-39s64-36,68-38s36-15,39-15s26-1,33-5s57-36,71-40s36-13,49-15s29-11,31-13s12-14,19-17s16-8,19-8s4,2,6,8s44,123,45,127s3,7,9,5s115-40,123-42s100-26,109-28s136-38,139-38s4-1,5,3s4,19,6,21s30-6,32-7s1-3,0-7s-4-20-6-21s-12,0-23,3s-242,64-264,70s-110,36-116,39s-10,6-12,1s-45-129-47-133s-5-5-9-3s-15,7-20,10s-13,9-17,14s-22,13-27,14s-35,8-48,13s-59,33-72,39s-24,6-34,7s-28,10-43,17s-55,28-63,33s-27,16-33,21s-24,17-34,22s-27,13-40,18s-41,14-45,16s-42,38-45,40s-19,9-26,11s-15,2-18,6s-11,16-11,18s1,4,4,10c0,0,28,57,29,61s1,7-5,8s-65,33-70,36s-10,5-14-2s-178-316-183-325s-37-63-79-119s-154-207-163-219s-224-300-231-308s-71-80-91-97s-87-90-90-95s-7-2-12,1s-52,34-54,35s-3,1-6-3s-19-31-20-33s-3-4,1-7c3.58-2.68,7-5,7-5" />
    </svg>
  </div>

  <!-- Info overlay -->
  <div id="info" class="hidden">
    <h2>üö¥‚Äç‚ôÇÔ∏è Training Stats</h2>
    <div class="stat-row">
      <span class="stat-label">Distance:</span>
      <span class="stat-value" id="distance">0.0 / 8.2 km</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Time:</span>
      <span class="stat-value" id="timeElapsed">00:00</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Remaining:</span>
      <span class="stat-value" id="timeRemaining">--:--</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Elevation:</span>
      <span class="stat-value" id="elevation">0 m</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Progress:</span>
      <span class="stat-value" id="progress">0%</span>
    </div>
    <div class="speed-controls">
      <div class="stat-row">
        <span class="stat-label">Speed:</span>
        <input type="number" id="speedAdjust" value="12" min="1" max="50" step="0.5" onchange="adjustSpeed()">
      </div>
    </div>
  </div>

  <!-- Control buttons -->
  <div id="controls" class="hidden">
    <button class="btn" id="pauseBtn" onclick="togglePause()">‚è∏ Pause</button>
    <button class="btn" onclick="restartTraining()">üîÑ Restart</button>
    <button class="btn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
  </div>

  <!-- Progress bar -->
  <div id="progressBar">
    <div id="progressFill"></div>
  </div>

  <!-- GSAP Libraries -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/gsap@3/dist/MotionPathPlugin.min.js"></script>

  <script>
    // Register plugins
    gsap.registerPlugin(MotionPathPlugin);

    // Route data (mock - will come from GPX in real implementation)
    const ROUTE_DATA = {
      distance: 8.2, // km
      elevationProfile: [ // Mock elevation data
        0, 10, 15, 25, 40, 55, 50, 45, 60, 58, 52, 48, 35, 20, 10, 5, 0
      ]
    };

    let timeline = null;
    let isPaused = false;
    let startTime = null;
    let pausedTime = 0;

    function startTraining() {
      const speed = parseFloat(document.getElementById('speedInput').value);
      if (!speed || speed <= 0) {
        alert('Please enter a valid speed');
        return;
      }

      // Hide welcome, show controls and info
      document.getElementById('welcome').classList.add('hidden');
      document.getElementById('info').classList.remove('hidden');
      document.getElementById('controls').classList.remove('hidden');

      // Update speed in adjustment input
      document.getElementById('speedAdjust').value = speed;

      // Calculate duration (distance / speed * 3600 seconds)
      const durationSeconds = (ROUTE_DATA.distance / speed) * 3600;

      // Initialize timeline
      initTimeline(durationSeconds, speed);

      // Start animation
      timeline.play();
      startTime = Date.now();

      // Fade in container
      gsap.to('#container', {
        duration: 1,
        opacity: 1,
        ease: 'power2.inOut'
      });
    }

    function initTimeline(durationSeconds, speed) {
      // Create GSAP timeline
      timeline = gsap.timeline({
        paused: true,
        onUpdate: function() {
          updateStats(timeline.progress(), durationSeconds, speed);
        },
        onComplete: function() {
          alert('üéâ Training complete! Great job!');
        }
      });

      // Animate marker along path
      timeline.to('#marker', {
        motionPath: {
          path: '#routePath',
          align: '#routePath',
          alignOrigin: [0.5, 0.5]
        },
        duration: durationSeconds,
        ease: 'none' // Constant speed
      });

      // Move container to follow marker (keeps marker centered)
      const xTo = gsap.quickTo('#container', 'x', { duration: 0.7 });
      const yTo = gsap.quickTo('#container', 'y', { duration: 0.7 });
      
      gsap.ticker.add(() => {
        xTo(-gsap.getProperty('#marker', 'x'));
        yTo(-gsap.getProperty('#marker', 'y'));
      });
    }

    function updateStats(progress, totalDuration, speed) {
      // Distance
      const distanceTraveled = (ROUTE_DATA.distance * progress).toFixed(2);
      document.getElementById('distance').textContent = 
        `${distanceTraveled} / ${ROUTE_DATA.distance} km`;

      // Progress percentage
      const progressPercent = Math.round(progress * 100);
      document.getElementById('progress').textContent = progressPercent + '%';
      document.getElementById('progressFill').style.width = progressPercent + '%';

      // Time elapsed
      const elapsedSeconds = isPaused 
        ? pausedTime 
        : Math.floor((Date.now() - startTime) / 1000);
      const elapsedMinutes = Math.floor(elapsedSeconds / 60);
      const elapsedSecs = elapsedSeconds % 60;
      document.getElementById('timeElapsed').textContent = 
        `${String(elapsedMinutes).padStart(2, '0')}:${String(elapsedSecs).padStart(2, '0')}`;

      // Time remaining
      const remainingSeconds = Math.max(0, totalDuration - elapsedSeconds);
      const remainingMinutes = Math.floor(remainingSeconds / 60);
      const remainingSecs = Math.floor(remainingSeconds % 60);
      document.getElementById('timeRemaining').textContent = 
        `${String(remainingMinutes).padStart(2, '0')}:${String(remainingSecs).padStart(2, '0')}`;

      // Elevation (mock - interpolate from profile)
      const elevationIndex = Math.floor(progress * (ROUTE_DATA.elevationProfile.length - 1));
      const elevation = ROUTE_DATA.elevationProfile[elevationIndex] || 0;
      document.getElementById('elevation').textContent = elevation + ' m';
    }

    function togglePause() {
      if (!timeline) return;

      const btn = document.getElementById('pauseBtn');
      
      if (isPaused) {
        // Resume
        timeline.play();
        btn.textContent = '‚è∏ Pause';
        startTime = Date.now() - pausedTime * 1000;
        isPaused = false;
      } else {
        // Pause
        timeline.pause();
        btn.textContent = '‚ñ∂ Resume';
        pausedTime = Math.floor((Date.now() - startTime) / 1000);
        isPaused = true;
      }
    }

    function restartTraining() {
      if (!timeline) {
        return;
      }

      if (confirm('Restart training from the beginning?')) {
        // Reset timeline
        timeline.restart();
        startTime = Date.now();
        pausedTime = 0;
        isPaused = false;
        document.getElementById('pauseBtn').textContent = '‚è∏ Pause';
      }
    }

    function adjustSpeed() {
      if (!timeline) return;

      const newSpeed = parseFloat(document.getElementById('speedAdjust').value);
      if (!newSpeed || newSpeed <= 0) return;

      // Calculate new duration
      const newDuration = (ROUTE_DATA.distance / newSpeed) * 3600;
      
      // Get current progress
      const currentProgress = timeline.progress();
      
      // Kill old timeline
      timeline.kill();
      
      // Create new timeline with new duration
      initTimeline(newDuration, newSpeed);
      
      // Set to current progress
      timeline.progress(currentProgress);
      
      // Play if not paused
      if (!isPaused) {
        timeline.play();
      } else {
        timeline.pause();
      }

      // Adjust start time to account for new duration
      const elapsedSeconds = (newDuration * currentProgress);
      startTime = Date.now() - elapsedSeconds * 1000;
      
      console.log(`Speed adjusted to ${newSpeed} km/h (duration: ${Math.round(newDuration)}s)`);
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    // Center container on load/resize
    function centerContainer() {
      gsap.set('#container', {
        left: innerWidth / 2,
        top: innerHeight / 2
      });
    }

    window.onload = window.onresize = centerContainer;

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.key === 'Spacebar') {
        e.preventDefault();
        togglePause();
      } else if (e.key === 'f' || e.key === 'F') {
        toggleFullscreen();
      } else if (e.key === 'r' || e.key === 'R') {
        restartTraining();
      }
    });

    console.log('üèÉ‚Äç‚ôÇÔ∏è Virtual Training Experience POC loaded');
    console.log('üìù Key differences from scroll-based version:');
    console.log('  ‚úÖ Time-based animation (not scroll)');
    console.log('  ‚úÖ User inputs speed ‚Üí calculates duration');
    console.log('  ‚úÖ Real-time stats update');
    console.log('  ‚úÖ Play/pause/restart controls');
    console.log('  ‚úÖ Speed adjustment during training');
    console.log('');
    console.log('üéÆ Keyboard shortcuts:');
    console.log('  Space - Play/Pause');
    console.log('  F - Fullscreen');
    console.log('  R - Restart');
    console.log('');
    console.log('üìù Next steps:');
    console.log('  1. Replace static map with Mapbox');
    console.log('  2. Parse real GPX data for accurate distance/elevation');
    console.log('  3. Sync Mapbox camera with marker position');
    console.log('  4. Add terrain/satellite view toggle');
    console.log('  5. Integrate with WordPress route-player block');
  </script>

</body>
</html>
